# Sprint Planning — Add Admin Role (spin-off)

Target: Tambah role **admin** pada aplikasi Pinjam In dan buat implementasi minimal yang aman (DB RLS + client changes + basic admin UI) sebagai spin-off branch `feature/admin-role-design`.

Durasi sprint: 1–2 minggu (bekerja sendiri / tim kecil). Prioritas: keamanan RLS, minim perubahan client, deliverable: migration SQL + client support + admin dashboard read-only.

## Goals

-   Menambahkan role `admin` pada backend (Supabase) dengan RLS yang aman.
-   Memperbarui Flutter client agar dapat membaca role user dan tampilkan menu/admin dashboard sederhana.
-   Pastikan perilaku lama (single-user) tetap berjalan.

## Milestones

1. Analysis & design (sudah selesai) — docs/analysist.md
2. DB migration & RLS update — buat migration SQL + apply di Supabase (manual atau via migration tool)
3. Client: AuthProvider -> fetch profile role
4. Client: UI — Settings role display + Admin Dashboard (read-only list of items & users)
5. Tests & review, final polish

## Backlog (breakdown tasks, actionable) — estimates given per task

Phase A — Migration & DB (3.5h)
A1. Create `profiles` table migration SQL (0.5h)
A2. Seed existing users into `profiles` with role='user' (0.25h)
A3. Add/replace RLS policies for `items` to allow admin access (1h)
A4. Test RLS policies using Supabase SQL editor / psql (1h)
A5. Add storage policy or admin storage helper note (0.75h)

Phase B — Client & Services (6h)
B1. Update `AuthProvider` to load profile and expose `role` (1.5h) - Add method `Future<void> loadProfile()` - Call after login and on init if session exists
B2. Add model `lib/models/user_profile.dart` (0.25h)
B3. Wire role into app state (provide to widgets) (0.5h)
B4. Update `SupabasePersistence` / `LoanProvider` UX checks for admin (optional; hide confirm modals etc) (0.5h)
B5. Add small admin-only helper in persistence for tests if needed (0.5h)
B6. Add basic unit tests for AuthProvider role fetch (1h)
B7. Run `flutter analyze` and fix lints (0.75h)

Phase C — UI (5–7h)
C1. Add `screens/admin_dashboard.dart` (list items + users) — read-only (2h)
C2. Add menu entry in `Settings` or drawer (0.5h)
C3. Add `Profile`/`Settings` view display role (0.5h)
C4. Guard admin routes (show/hide) (0.25h)
C5. Styling & minor UX polish (1.5–3h)

Phase D — QA, docs, and wrap-up (2.5h)
D1. End-to-end smoke test (login, admin view, try RLS-restricted actions) (1h)
D2. Document steps to apply migration on live Supabase in README or docs (0.75h)
D3. Prepare PR description and changelog (0.75h)

## Minimal deliverable for grading (MVP)

-   SQL migration file (profiles table + updated RLS) — must be runnable in Supabase SQL editor.
-   AuthProvider changes to fetch profile role and expose ke UI.
-   Basic Admin Dashboard screen listing all items (read-only) and list of profiles.

## Risks & Mitigations

-   Risk: RLS misconfiguration -> data leakage.
    Mitigation: Test RLS with dummy accounts and attempt cross-access before shipping.
-   Risk: service_role exposure.
    Mitigation: do not embed service role in client. Use server-side functions if needed.

## Next actions (short term)

1. Apply migration SQL on a non-production Supabase project for verification. (owner)
2. Implement `AuthProvider.loadProfile()` and wire into UI (developer).

---

_Generated by analysis on branch `feature/admin-role-design`_
